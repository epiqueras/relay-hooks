"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var t=require("relay-runtime"),n=require("react"),r=e(n),o=e(require("fbjs/lib/areEqual")),i=e(require("fbjs/lib/invariant")),s=e(require("fbjs/lib/warning")),a=e(require("@restart/hooks/useMounted")),u=(0,t.__internal.createRelayContext)(r),c=function(){return(c=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},l=function(e,t){return"network-only"===e||"store-and-network"===e||"store-or-network"===e&&!t},f=function(e){return"network-only"!==e};function p(e,n){return t.createOperationDescriptor(t.getRequest(e),n)}function h(e){return"function"==typeof e?{error:e,complete:e,unsubscribe:function(t){"function"==typeof e&&e()}}:e||{}}function d(e,t){if(!e){var n=function(e){var t=null,n=!1,r=e.metadata&&e.metadata.connection;return void 0!==e.metadata&&(n=!0),r&&(i(1===r.length,"ReactRelayPaginationContainer: Only a single @connection is supported, `%s` has %s.",e.name,r.length),i(!t,"ReactRelayPaginationContainer: Only a single fragment with @connection is supported."),t=c(c({},r[0]),{fragmentName:e.name})),i(!n||null!==t,"ReactRelayPaginationContainer: A @connection directive must be present."),t||{}}(t),r=function(e){var t=e.path;return i(t,"ReactRelayPaginationContainer: Unable to synthesize a getConnectionFromProps function."),function(e){for(var n=e,r=0;r<t.length;r++){if(!n||"object"!=typeof n)return null;n=n[t[r]]}return n}}(n),o=n.direction;return i(o,"ReactRelayPaginationContainer: Unable to infer direction of the connection, possibly because both first and last are provided."),{direction:o,getConnectionFromProps:r,getFragmentVariables:function(e){var t=e.count;return i(t,"ReactRelayPaginationContainer: Unable to synthesize a getFragmentVariables function."),function(e,n){var r;return c(c({},e),((r={})[t]=n,r))}}(n)}}return e}function b(e,n,r){if(o(r,n.variables))return n;var i=t.createRequestDescriptor(e,r);return t.createReaderSelector(n.node,n.dataID,r,i)}function g(e,n,r){var o=e.direction,a=(r&&r.getConnectionFromProps?r.getConnectionFromProps:e.getConnectionFromProps)(n);if(null==a)return null;var u=t.ConnectionInterface.get(),c=u.EDGES,l=u.PAGE_INFO,f=u.HAS_NEXT_PAGE,p=u.HAS_PREV_PAGE,h=u.END_CURSOR,d=u.START_CURSOR;i("object"==typeof a,"ReactRelayPaginationContainer: Expected `getConnectionFromProps()` in `%s`to return `null` or a plain object with %s and %s properties, got `%s`.","useFragment pagination",c,l,a);var b=a[c],g=a[l];if(null==b||null==g)return null;i(Array.isArray(b),"ReactRelayPaginationContainer: Expected `getConnectionFromProps()` in `%s`to return an object with %s: Array, got `%s`.","useFragment pagination",c,b),i("object"==typeof g,"ReactRelayPaginationContainer: Expected `getConnectionFromProps()` in `%s`to return an object with %s: Object, got `%s`.","useFragment pagination",l,g);var m="forward"===o?g[f]:g[p],v="forward"===o?g[h]:g[d];return"boolean"!=typeof m||0!==b.length&&void 0===v?(s(!1,"ReactRelayPaginationContainer: Cannot paginate without %s fields in `%s`. Be sure to fetch %s (got `%s`) and %s (got `%s`).",l,"useFragment pagination","forward"===o?f:p,m,"forward"===o?h:d,v),null):{cursor:v,edgeCount:b.length,hasMore:m}}var m=t.__internal.fetchQuery,v=new Map;function y(e,t){var n=!!e,r=n&&v.has(e.request.identifier)?v.get(e.request.identifier):new _(n,n);return r.setForceUpdate(t),r}var _=function(){function e(e,t){void 0===e&&(e=!1),void 0===t&&(t=!1),this.suspense=e,this.useLazy=e&&t,this.setForceUpdate((function(){}))}return e.prototype.setForceUpdate=function(e){this.forceUpdate=e},e.prototype.dispose=function(){this.disposeRequest(),this.disposeRetain()},e.prototype.disposeRetain=function(){this.clearTemporaryRetain(),this.disposableRetain&&this.disposableRetain.dispose(),this.query&&v.delete(this.query.request.identifier)},e.prototype.clearTemporaryRetain=function(){clearTimeout(this.releaseQueryTimeout),this.releaseQueryTimeout=null},e.prototype.temporaryRetain=function(){var e=this;this.releaseQueryTimeout=setTimeout((function(){e.dispose()}),3e4)},e.prototype.isDiffEnvQuery=function(e,t){return e!==this.environment||t.request.identifier!==this.query.request.identifier},e.prototype.lookupInStore=function(e,t,n){if(f(n)){var r=e.check(t);if("available"===r||"available"===r.status)return e.lookup(t.fragment)}return null},e.prototype.execute=function(e,t,n,r){var o=this;void 0===r&&(r=function(e,t){return e.retain(t)});var i,s=n.fetchPolicy,a=void 0===s?"store-or-network":s,u=n.networkCacheConfig,c=n.fetchKey,f=n.fetchObserver,p=function(e,t){void 0===e&&(e=u),o.disposeRequest(),o.fetch(e,!1,t)};if(n.skip)return{cached:!1,retry:p,error:null,props:void 0};this.clearTemporaryRetain();var h=this.isDiffEnvQuery(e,t);(h||a!==this.fetchPolicy||c!==this.fetchKey)&&(h&&(this.disposeRetain(),this.useLazy&&v.set(t.request.identifier,this),this.disposableRetain=r(e,t)),this.environment=e,this.query=t,this.fetchPolicy=a,this.fetchKey=c,this.disposeRequest(),i=this.lookupInStore(e,this.query,a),l(a,i)?this.fetch(u,this.suspense&&!i,f):i&&(this.snapshot=i,this.error=null,this.subscribe(i)));var d=i||this.snapshot;return{cached:!!i,retry:p,error:this.error,props:d?d.data:null}},e.prototype.subscribe=function(e){var t=this;this.rootSubscription&&this.rootSubscription.dispose(),this.rootSubscription=this.environment.subscribe(e,(function(e){t.snapshot=e,t.error=null,t.forceUpdate(e)}))},e.prototype.fetch=function(e,t,n){var r=this;void 0===n&&(n={});var o=!1,i=function(){};if(m(this.environment,this.query,{networkCacheConfig:t&&!e?{force:!0}:e}).subscribe({start:function(e){r.networkSubscription={dispose:function(){return e.unsubscribe()}},n.start&&n.start(e)},next:function(){r.error=null,r._onQueryDataAvailable({notifyFirstResult:o,suspense:t,observer:n}),i()},error:function(e){r.error=e,r.snapshot=null,o&&!t&&r.forceUpdate(e),i(),r.networkSubscription=null,n.error&&n.error(e)},complete:function(){r.networkSubscription=null,n.complete&&n.complete()},unsubscribe:function(e){r.useLazy&&!r.rootSubscription&&r.releaseQueryTimeout&&r.dispose(),n.unsubscribe&&n.unsubscribe(e)}}),o=!0,t)throw this.useLazy&&(this.setForceUpdate((function(){})),this.temporaryRetain()),new Promise((function(e){i=e}))},e.prototype.disposeRequest=function(){this.error=null,this.snapshot=null,this.networkSubscription&&(this.networkSubscription.dispose(),this.networkSubscription=null),this.rootSubscription&&(this.rootSubscription.dispose(),this.rootSubscription=null)},e.prototype._onQueryDataAvailable=function(e){var t=e.notifyFirstResult,n=e.suspense,r=e.observer;this.snapshot||(this.snapshot=this.environment.lookup(this.query.fragment),this.subscribe(this.snapshot),r.next&&r.next(this.snapshot),this.snapshot&&t&&!n&&this.forceUpdate(this.snapshot))},e}(),R=function(e){var t=n.useState(null)[1],r=n.useRef();return null==r.current&&(r.current={queryFetcher:y(e,t)}),n.useEffect((function(){return function(){return r.current.queryFetcher.dispose()}}),[]),r.current.queryFetcher};function x(){return r.useContext(u).environment}function S(e,t){var r,i,s=(i=n.useRef(r=t),o(i.current,r)||(i.current=r),i.current);return n.useMemo((function(){return p(e,s)}),[e,s])}var w=function(e,n){void 0===e&&(e=!1),void 0===n&&(n=function(e,t,n,r,o){return e.execute(t,n,r,o)});var r=null,i=void 0,s=new _(!0),a={environment:null,gqlQuery:null,variables:null,options:null,query:null},u=function(t,u,c,l){void 0===c&&(c={}),void 0===l&&(l={}),a.environment=t,a.options=l,o(c,a.variables)&&u==a.gqlQuery||(a.variables=c,a.gqlQuery=u,a.query=p(u,a.variables));var f,h=function(){r=n(s,a.environment,a.query,a.options),i&&i(r)};s.setForceUpdate(h);try{h()}catch(t){f=t.then(h),e?r=f:h()}return null!=f?f:Promise.resolve()};return{next:u,subscribe:function(e){return i=e,function(){i===e&&(i=null)}},getValue:function(e){if(e&&e!=a.environment&&u(e,a.gqlQuery,a.variables,a.options),t.isPromise(r))throw r;return r},dispose:function(){s.dispose(),s=new _(!0),i=void 0,r=null,a={environment:null,gqlQuery:null,variables:null,options:null,query:null}}}},F=t.__internal.fetchQuery;function C(e){return Array.isArray(e)?{snapshot:e,data:e.map((function(e){return e.data}))}:{snapshot:e,data:e.data}}var P=function(){function e(e){var n=this;this._disposable={dispose:function(){}},this._isARequestInFlight=!1,this._selectionReferences=[],this.indexUpdate=0,this.refetch=function(e,t,r,o,i){var s=n.getFragmentVariables(),a="function"==typeof t?t(s):t,u=r?c(c({},a),r):a;return n.executeFetcher(e,a,i,"function"==typeof o?{next:o,error:o}:o||{},(function(e,t,r){n.changeVariables(u,e.request.node),n.refreshHooks(),r()}))},this.isLoading=function(){return!!n._refetchSubscription},this.hasMore=function(e){n.paginationData=d(n.paginationData,n._fragment);var t=g(n.paginationData,n.getData(),e);return!!(t&&t.hasMore&&t.cursor)},this.refetchConnection=function(e,t,r,o){return n.paginationData=d(n.paginationData,n._fragment),n._refetchVariables=o,n._fetchPage(e,{count:t,cursor:null,totalCount:t},h(r),{force:!0})},this.loadMore=function(e,r,o,i){n.paginationData=d(n.paginationData,n._fragment);var s=h(o),a=g(n.paginationData,n.getData(),e);if(!a)return t.Observable.create((function(e){return e.complete()})).subscribe(s),null;var u=a.edgeCount+r;return i&&i.force?n.refetchConnection(e,u,o,void 0):n._fetchPage(e,{count:r,cursor:a.cursor,totalCount:u},s,i)},this._forceUpdate=e}return e.prototype.refreshHooks=function(){this.indexUpdate+=1,this._forceUpdate(this.indexUpdate)},e.prototype.dispose=function(){this._disposable&&this._disposable.dispose(),this._refetchSubscription&&this._refetchSubscription.unsubscribe(),this._refetchSubscription=null,this.disposeSelectionReferences(),this._isARequestInFlight=!1},e.prototype.disposeSelectionReferences=function(){this._disposeCacheSelectionReference(),this._selectionReferences.forEach((function(e){return e.dispose()})),this._selectionReferences=[]},e.prototype._retainCachedOperation=function(e){this._disposeCacheSelectionReference(),this._cacheSelectionReference=this._environment.retain(e)},e.prototype._disposeCacheSelectionReference=function(){this._cacheSelectionReference&&this._cacheSelectionReference.dispose(),this._cacheSelectionReference=null},e.prototype.getFragmentVariables=function(e){return void 0===e&&(e=this._fragmentRef),t.getVariablesFromFragment(this._fragment,e)},e.prototype.changedFragmentRef=function(e){if(this._fragmentRef!==e){var n=t.getDataIDsFromFragment(this._fragment,this._fragmentRef),r=t.getDataIDsFromFragment(this._fragment,e);if(!o(n,r)||!o(this.getFragmentVariables(e),this.getFragmentVariables(this._fragmentRef)))return!0}return!1},e.prototype.resolve=function(e,n,r){this._fragmentNode!==n&&(this._fragment=t.getFragment(n),this.paginationData=null),(this._environment!==e||this._fragmentNode!==n||this.changedFragmentRef(r))&&(this._environment=e,this._fragmentNode=n,this._fragmentRef=r,this._result=null,this.dispose(),null==this._fragmentRef&&(this._result={data:null,snapshot:null}),this._isPlural=this._fragment.metadata&&this._fragment.metadata.plural&&!0===this._fragment.metadata.plural,this._isPlural&&0===this._fragmentRef.length&&(this._result={data:[],snapshot:[]}),this._result||(this._selector=t.getSelector(this._fragment,this._fragmentRef),this.lookup()))},e.prototype.lookup=function(){var e,t,n=(e=this._environment,"PluralReaderSelector"===(t=this._selector).kind?t.selectors.map((function(t){return e.lookup(t)})):e.lookup(t));this._result=C(n),this.subscribe()},e.prototype.getData=function(){return this._result?this._result.data:null},e.prototype.subscribe=function(){var e=this,t=this._environment,n=this._result.snapshot;this._disposable&&this._disposable.dispose(),n||(this._disposable={dispose:function(){}});var r=[];Array.isArray(n)?n.forEach((function(n,o){r.push(t.subscribe(n,(function(t){e._result.snapshot[o]=t,e._result.data[o]=t.data,e.refreshHooks()})))})):r.push(t.subscribe(n,(function(t){e._result=C(t),e.refreshHooks()}))),this._disposable={dispose:function(){r.map((function(e){return e.dispose()}))}}},e.prototype.changeVariables=function(e,t){"PluralReaderSelector"===this._selector.kind?this._selector.selectors=this._selector.selectors.map((function(n){return b(t,n,e)})):this._selector=b(t,this._selector,e),this.lookup()},e.prototype.lookupInStore=function(e,t,n){if(f(n)){var r=e.check(t);if("available"===r||"available"===r.status)return this._retainCachedOperation(t),e.lookup(t.fragment)}return null},e.prototype._fetchPage=function(e,t,n,r){var s,a=this,u=null!=(s=this._selector)&&"PluralReaderSelector"===s.kind?s.selectors[0]?s.selectors[0].owner.variables:{}:s?s.owner.variables:{},l=c(c(c({},u),this.getFragmentVariables()),this._refetchVariables),f=e.getVariables(this.getData(),{count:t.count,cursor:t.cursor},l);return i("object"==typeof f&&null!==f,"ReactRelayPaginationContainer: Expected `getVariables()` to return an object, got `%s` in `%s`.",f,"useFragment pagination"),f=c(c({},f),this._refetchVariables),l=c(c({},f),l),this.executeFetcher(e.query,f,r,n,(function(n,r,i){var s=a.getData();a.changeVariables((e.getFragmentVariables||a.paginationData.getFragmentVariables)(l,t.totalCount),n.request.node);var u,c,f,p=a.getData();o(s,p)?i():(a.refreshHooks(),u=a,f=function(){return function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!((o=(o=s.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}}(this,(function(e){return i(),[2]}))},new((c=void 0)||(c=Promise))((function(e,t){function n(e){try{o(f.next(e))}catch(e){t(e)}}function r(e){try{o(f.throw(e))}catch(e){t(e)}}function o(t){t.done?e(t.value):new c((function(e){e(t.value)})).then(n,r)}o((f=f.apply(u,[])).next())})))}))},e.prototype.executeFetcher=function(e,n,r,o,i){var s=this,a=r?{force:!!r.force}:void 0;null!=a&&r&&null!=r.metadata&&(a.metadata=r.metadata);var u,f="function"==typeof o?{next:o,error:o}:o||{},h=p(e,n),d=(r||{}).fetchPolicy,b=void 0===d?"network-only":d,g=this.lookupInStore(this._environment,h,b);null!=g&&i(h,null,(function(){f.next&&f.next(),f.complete&&f.complete()})),this._refetchSubscription&&this._refetchSubscription.unsubscribe();var m=l(b,g);if(!m)return{dispose:function(){}};if(m){var v=this._environment.retain(h),y=null!=a?{networkCacheConfig:a}:{},_=function(){s._selectionReferences=s._selectionReferences.concat(v),s._refetchSubscription===u&&(s._refetchSubscription=null,s._isARequestInFlight=!1)};this._isARequestInFlight=!0,F(this._environment,h,y).mergeMap((function(e){return t.Observable.create((function(t){i(h,e,(function(){t.next(void 0),t.complete()}))}))})).do({error:_,complete:_,unsubscribe:_}).subscribe(c(c({},f),{start:function(e){u=e,s._refetchSubscription=s._isARequestInFlight?u:null,f.start&&f.start(e)}}))}return{dispose:function(){u&&u.unsubscribe()}}},e}();function q(e,t){var r=x(),o=n.useState(null)[1],i=n.useRef(null);null==i.current&&(i.current={resolver:new P(o)});var s=i.current.resolver;return n.useEffect((function(){return function(){s.dispose()}}),[s]),s.resolve(r,e,t),[s.getData(),s]}var k=r.useCallback,E=r.useState;function O(e,t){var n=q(e,t);return[n[0],n[1].refetch]}Object.defineProperty(exports,"applyOptimisticMutation",{enumerable:!0,get:function(){return t.applyOptimisticMutation}}),Object.defineProperty(exports,"commitLocalUpdate",{enumerable:!0,get:function(){return t.commitLocalUpdate}}),Object.defineProperty(exports,"commitMutation",{enumerable:!0,get:function(){return t.commitMutation}}),Object.defineProperty(exports,"fetchQuery",{enumerable:!0,get:function(){return t.fetchQuery}}),Object.defineProperty(exports,"graphql",{enumerable:!0,get:function(){return t.graphql}}),Object.defineProperty(exports,"requestSubscription",{enumerable:!0,get:function(){return t.requestSubscription}}),exports.FORWARD="forward",exports.NETWORK_ONLY="network-only",exports.ReactRelayContext=u,exports.RelayEnvironmentProvider=function(e){var t=r.useMemo((function(){return{environment:e.environment}}),[e.environment]);return r.createElement(u.Provider,{value:t},e.children)},exports.STORE_ONLY="store-only",exports.STORE_OR_NETWORK="store-or-network",exports.STORE_THEN_NETWORK="store-and-network",exports.loadLazyQuery=function(){return w(!0)},exports.loadQuery=function(){return w(!1)},exports.useFragment=function(e,t){return q(e,t)[0]},exports.useLazyLoadQuery=function(e,t,n){void 0===t&&(t={}),void 0===n&&(n={});var r=x(),o=S(e,t);return R(o).execute(r,o,n)},exports.useMutation=function(e,n,r){void 0===n&&(n={});var o=E({loading:!1,data:null,error:null}),s=o[0],u=o[1],l=a(),f=x(),p=r||f,h=n.configs,d=n.variables,b=n.uploadables,g=n.onCompleted,m=n.onError,v=n.optimisticUpdater,y=n.optimisticResponse,_=n.updater;return[k((function(n){var r=c({configs:h,variables:d,uploadables:b,onCompleted:g,onError:m,optimisticUpdater:v,optimisticResponse:y,updater:_},n);return i(r.variables,"you must specify variables"),u({loading:!0,data:null,error:null}),new Promise((function(n,o){function i(e){l()&&u({loading:!1,data:null,error:e}),r.onError?(r.onError(e),n()):o(e)}t.commitMutation(p,c(c({},r),{mutation:e,variables:r.variables,onCompleted:function(e,t){t?i(t):(l()&&u({loading:!1,data:e,error:null}),r.onCompleted&&r.onCompleted(e),n(e))},onError:i}))}))}),[p,h,e,d,b,g,m,v,y,_,l]),s]},exports.useOssFragment=q,exports.usePagination=function(e,t){var r=q(e,t),o=r[1];return[r[0],n.useMemo((function(){return{loadMore:o.loadMore,hasMore:o.hasMore,isLoading:o.isLoading,refetchConnection:o.refetchConnection}}),[o])]},exports.usePreloadedQuery=function(e){var t=n.useState()[1],r=x();return n.useEffect((function(){var n=e.subscribe(t);return function(){return n()}}),[e]),e.getValue(r)},exports.useQuery=function(e,t,n){void 0===t&&(t={}),void 0===n&&(n={});var r=x(),o=S(e,t);return R().execute(r,o,n)},exports.useQueryFetcher=R,exports.useRefetch=O,exports.useRefetchable=function(e,r){var o=O(e,r),s=o[0],a=o[1],u=n.useMemo((function(){var n=t.getFragment(e),r=n.metadata;i(null!=r,"useRefetchable: Expected fragment `%s` to be refetchable when using `%s`. Did you forget to add a @refetchable directive to the fragment?","useRefetchable",n.name),i(!0!==r.plural,"useRefetchable: Expected fragment `%s` not to be plural when using `%s`. Remove `@relay(plural: true)` from fragment `%s` in order to use it with `%s`.",n.name,"useRefetchable",n.name,"useRefetchable");var o=r.refetch;return i(null!=o,"useRefetchable: Expected fragment `%s` to be refetchable when using `%s`. Did you forget to add a @refetchable directive to the fragment?","useRefetchable",n.name),o.operation.default?o.operation.default:o.operation}),[e]);return[s,n.useCallback((function(e,t){return void 0===t&&(t={}),a(u,e,t.renderVariables,t.observerOrCallback,t.refetchOptions)}),[a,u])]},exports.useRelayEnvironment=x,exports.useSubscription=function(e){var r=x();n.useEffect((function(){return t.requestSubscription(r,e).dispose}),[r,e])};
//# sourceMappingURL=cjs-relay-hooks.min.js.map

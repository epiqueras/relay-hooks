!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("relay-runtime"),require("react"),require("fbjs/lib/areEqual"),require("fbjs/lib/invariant"),require("fbjs/lib/warning"),require("@restart/hooks/useMounted")):"function"==typeof define&&define.amd?define(["exports","relay-runtime","react","fbjs/lib/areEqual","fbjs/lib/invariant","fbjs/lib/warning","@restart/hooks/useMounted"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self)["relay-hooks"]={},e.relayRuntime,e.React,e.areEqual,e.invariant,e.warning,e.useMounted)}(this,(function(e,t,n,r,o,i,a){"use strict";var s="default"in n?n.default:n;r=r&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r,o=o&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o,i=i&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i,a=a&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a;var u=(0,t.__internal.createRelayContext)(s),c=function(){return(c=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},l=function(e,t){return"network-only"===e||"store-and-network"===e||"store-or-network"===e&&!t},f=function(e){return"network-only"!==e};function p(e,n){return t.createOperationDescriptor(t.getRequest(e),n)}function h(e){return"function"==typeof e?{error:e,complete:e,unsubscribe:function(t){"function"==typeof e&&e()}}:e||{}}function d(e,t){if(!e){var n=function(e){var t=null,n=!1,r=e.metadata&&e.metadata.connection;return void 0!==e.metadata&&(n=!0),r&&(o(1===r.length,"ReactRelayPaginationContainer: Only a single @connection is supported, `%s` has %s.",e.name,r.length),o(!t,"ReactRelayPaginationContainer: Only a single fragment with @connection is supported."),t=c(c({},r[0]),{fragmentName:e.name})),o(!n||null!==t,"ReactRelayPaginationContainer: A @connection directive must be present."),t||{}}(t),r=function(e){var t=e.path;return o(t,"ReactRelayPaginationContainer: Unable to synthesize a getConnectionFromProps function."),function(e){for(var n=e,r=0;r<t.length;r++){if(!n||"object"!=typeof n)return null;n=n[t[r]]}return n}}(n),i=n.direction;return o(i,"ReactRelayPaginationContainer: Unable to infer direction of the connection, possibly because both first and last are provided."),{direction:i,getConnectionFromProps:r,getFragmentVariables:function(e){var t=e.count;return o(t,"ReactRelayPaginationContainer: Unable to synthesize a getFragmentVariables function."),function(e,n){var r;return c(c({},e),((r={})[t]=n,r))}}(n)}}return e}function b(e,n,o){if(r(o,n.variables))return n;var i=t.createRequestDescriptor(e,o);return t.createReaderSelector(n.node,n.dataID,o,i)}function g(e,n,r){var a=e.direction,s=(r&&r.getConnectionFromProps?r.getConnectionFromProps:e.getConnectionFromProps)(n);if(null==s)return null;var u=t.ConnectionInterface.get(),c=u.EDGES,l=u.PAGE_INFO,f=u.HAS_NEXT_PAGE,p=u.HAS_PREV_PAGE,h=u.END_CURSOR,d=u.START_CURSOR;o("object"==typeof s,"ReactRelayPaginationContainer: Expected `getConnectionFromProps()` in `%s`to return `null` or a plain object with %s and %s properties, got `%s`.","useFragment pagination",c,l,s);var b=s[c],g=s[l];if(null==b||null==g)return null;o(Array.isArray(b),"ReactRelayPaginationContainer: Expected `getConnectionFromProps()` in `%s`to return an object with %s: Array, got `%s`.","useFragment pagination",c,b),o("object"==typeof g,"ReactRelayPaginationContainer: Expected `getConnectionFromProps()` in `%s`to return an object with %s: Object, got `%s`.","useFragment pagination",l,g);var m="forward"===a?g[f]:g[p],y="forward"===a?g[h]:g[d];return"boolean"!=typeof m||0!==b.length&&void 0===y?(i(!1,"ReactRelayPaginationContainer: Cannot paginate without %s fields in `%s`. Be sure to fetch %s (got `%s`) and %s (got `%s`).",l,"useFragment pagination","forward"===a?f:p,m,"forward"===a?h:d,y),null):{cursor:y,edgeCount:b.length,hasMore:m}}var m=t.__internal.fetchQuery,y=new Map;function v(e,t){var n=!!e,r=n&&y.has(e.request.identifier)?y.get(e.request.identifier):new _(n,n);return r.setForceUpdate(t),r}var _=function(){function e(e,t){void 0===e&&(e=!1),void 0===t&&(t=!1),this.suspense=e,this.useLazy=e&&t,this.setForceUpdate((function(){}))}return e.prototype.setForceUpdate=function(e){this.forceUpdate=e},e.prototype.dispose=function(){this.disposeRequest(),this.disposeRetain()},e.prototype.disposeRetain=function(){this.clearTemporaryRetain(),this.disposableRetain&&this.disposableRetain.dispose(),this.query&&y.delete(this.query.request.identifier)},e.prototype.clearTemporaryRetain=function(){clearTimeout(this.releaseQueryTimeout),this.releaseQueryTimeout=null},e.prototype.temporaryRetain=function(){var e=this;this.releaseQueryTimeout=setTimeout((function(){e.dispose()}),3e4)},e.prototype.isDiffEnvQuery=function(e,t){return e!==this.environment||t.request.identifier!==this.query.request.identifier},e.prototype.lookupInStore=function(e,t,n){if(f(n)){var r=e.check(t);if("available"===r||"available"===r.status)return e.lookup(t.fragment)}return null},e.prototype.execute=function(e,t,n,r){var o=this;void 0===r&&(r=function(e,t){return e.retain(t)});var i,a=n.fetchPolicy,s=void 0===a?"store-or-network":a,u=n.networkCacheConfig,c=n.fetchKey,f=n.fetchObserver,p=function(e,t){void 0===e&&(e=u),o.disposeRequest(),o.fetch(e,!1,t)};if(n.skip)return{cached:!1,retry:p,error:null,props:void 0};this.clearTemporaryRetain();var h=this.isDiffEnvQuery(e,t);(h||s!==this.fetchPolicy||c!==this.fetchKey)&&(h&&(this.disposeRetain(),this.useLazy&&y.set(t.request.identifier,this),this.disposableRetain=r(e,t)),this.environment=e,this.query=t,this.fetchPolicy=s,this.fetchKey=c,this.disposeRequest(),i=this.lookupInStore(e,this.query,s),l(s,i)?this.fetch(u,this.suspense&&!i,f):i&&(this.snapshot=i,this.error=null,this.subscribe(i)));var d=i||this.snapshot;return{cached:!!i,retry:p,error:this.error,props:d?d.data:null}},e.prototype.subscribe=function(e){var t=this;this.rootSubscription&&this.rootSubscription.dispose(),this.rootSubscription=this.environment.subscribe(e,(function(e){t.snapshot=e,t.error=null,t.forceUpdate(e)}))},e.prototype.fetch=function(e,t,n){var r=this;void 0===n&&(n={});var o=!1,i=function(){};if(m(this.environment,this.query,{networkCacheConfig:t&&!e?{force:!0}:e}).subscribe({start:function(e){r.networkSubscription={dispose:function(){return e.unsubscribe()}},n.start&&n.start(e)},next:function(){r.error=null,r._onQueryDataAvailable({notifyFirstResult:o,suspense:t,observer:n}),i()},error:function(e){r.error=e,r.snapshot=null,o&&!t&&r.forceUpdate(e),i(),r.networkSubscription=null,n.error&&n.error(e)},complete:function(){r.networkSubscription=null,n.complete&&n.complete()},unsubscribe:function(e){r.useLazy&&!r.rootSubscription&&r.releaseQueryTimeout&&r.dispose(),n.unsubscribe&&n.unsubscribe(e)}}),o=!0,t)throw this.useLazy&&(this.setForceUpdate((function(){})),this.temporaryRetain()),new Promise((function(e){i=e}))},e.prototype.disposeRequest=function(){this.error=null,this.snapshot=null,this.networkSubscription&&(this.networkSubscription.dispose(),this.networkSubscription=null),this.rootSubscription&&(this.rootSubscription.dispose(),this.rootSubscription=null)},e.prototype._onQueryDataAvailable=function(e){var t=e.notifyFirstResult,n=e.suspense,r=e.observer;this.snapshot||(this.snapshot=this.environment.lookup(this.query.fragment),this.subscribe(this.snapshot),r.next&&r.next(this.snapshot),this.snapshot&&t&&!n&&this.forceUpdate(this.snapshot))},e}(),R=function(e){var t=n.useState(null)[1],r=n.useRef();return null==r.current&&(r.current={queryFetcher:v(e,t)}),n.useEffect((function(){return function(){return r.current.queryFetcher.dispose()}}),[]),r.current.queryFetcher};function w(){return s.useContext(u).environment}function S(e,t){var o,i,a=(i=n.useRef(o=t),r(i.current,o)||(i.current=o),i.current);return n.useMemo((function(){return p(e,a)}),[e,a])}var P=function(e,n){void 0===e&&(e=!1),void 0===n&&(n=function(e,t,n,r,o){return e.execute(t,n,r,o)});var o=null,i=void 0,a=new _(!0),s={environment:null,gqlQuery:null,variables:null,options:null,query:null},u=function(t,u,c,l){void 0===c&&(c={}),void 0===l&&(l={}),s.environment=t,s.options=l,r(c,s.variables)&&u==s.gqlQuery||(s.variables=c,s.gqlQuery=u,s.query=p(u,s.variables));var f,h=function(){o=n(a,s.environment,s.query,s.options),i&&i(o)};a.setForceUpdate(h);try{h()}catch(t){f=t.then(h),e?o=f:h()}return null!=f?f:Promise.resolve()};return{next:u,subscribe:function(e){return i=e,function(){i===e&&(i=null)}},getValue:function(e){if(e&&e!=s.environment&&u(e,s.gqlQuery,s.variables,s.options),t.isPromise(o))throw o;return o},dispose:function(){a.dispose(),a=new _(!0),i=void 0,o=null,s={environment:null,gqlQuery:null,variables:null,options:null,query:null}}}},F=t.__internal.fetchQuery;function C(e){return Array.isArray(e)?{snapshot:e,data:e.map((function(e){return e.data}))}:{snapshot:e,data:e.data}}var q=function(){function e(e){var n=this;this._disposable={dispose:function(){}},this._isARequestInFlight=!1,this._selectionReferences=[],this.indexUpdate=0,this.refetch=function(e,t,r,o,i){var a=n.getFragmentVariables(),s="function"==typeof t?t(a):t,u=r?c(c({},s),r):s;return n.executeFetcher(e,s,i,"function"==typeof o?{next:o,error:o}:o||{},(function(e,t,r){n.changeVariables(u,e.request.node),n.refreshHooks(),r()}))},this.isLoading=function(){return!!n._refetchSubscription},this.hasMore=function(e){n.paginationData=d(n.paginationData,n._fragment);var t=g(n.paginationData,n.getData(),e);return!!(t&&t.hasMore&&t.cursor)},this.refetchConnection=function(e,t,r,o){return n.paginationData=d(n.paginationData,n._fragment),n._refetchVariables=o,n._fetchPage(e,{count:t,cursor:null,totalCount:t},h(r),{force:!0})},this.loadMore=function(e,r,o,i){n.paginationData=d(n.paginationData,n._fragment);var a=h(o),s=g(n.paginationData,n.getData(),e);if(!s)return t.Observable.create((function(e){return e.complete()})).subscribe(a),null;var u=s.edgeCount+r;return i&&i.force?n.refetchConnection(e,u,o,void 0):n._fetchPage(e,{count:r,cursor:s.cursor,totalCount:u},a,i)},this._forceUpdate=e}return e.prototype.refreshHooks=function(){this.indexUpdate+=1,this._forceUpdate(this.indexUpdate)},e.prototype.dispose=function(){this._disposable&&this._disposable.dispose(),this._refetchSubscription&&this._refetchSubscription.unsubscribe(),this._refetchSubscription=null,this.disposeSelectionReferences(),this._isARequestInFlight=!1},e.prototype.disposeSelectionReferences=function(){this._disposeCacheSelectionReference(),this._selectionReferences.forEach((function(e){return e.dispose()})),this._selectionReferences=[]},e.prototype._retainCachedOperation=function(e){this._disposeCacheSelectionReference(),this._cacheSelectionReference=this._environment.retain(e)},e.prototype._disposeCacheSelectionReference=function(){this._cacheSelectionReference&&this._cacheSelectionReference.dispose(),this._cacheSelectionReference=null},e.prototype.getFragmentVariables=function(e){return void 0===e&&(e=this._fragmentRef),t.getVariablesFromFragment(this._fragment,e)},e.prototype.changedFragmentRef=function(e){if(this._fragmentRef!==e){var n=t.getDataIDsFromFragment(this._fragment,this._fragmentRef),o=t.getDataIDsFromFragment(this._fragment,e);if(!r(n,o)||!r(this.getFragmentVariables(e),this.getFragmentVariables(this._fragmentRef)))return!0}return!1},e.prototype.resolve=function(e,n,r){this._fragmentNode!==n&&(this._fragment=t.getFragment(n),this.paginationData=null),(this._environment!==e||this._fragmentNode!==n||this.changedFragmentRef(r))&&(this._environment=e,this._fragmentNode=n,this._fragmentRef=r,this._result=null,this.dispose(),null==this._fragmentRef&&(this._result={data:null,snapshot:null}),this._isPlural=this._fragment.metadata&&this._fragment.metadata.plural&&!0===this._fragment.metadata.plural,this._isPlural&&0===this._fragmentRef.length&&(this._result={data:[],snapshot:[]}),this._result||(this._selector=t.getSelector(this._fragment,this._fragmentRef),this.lookup()))},e.prototype.lookup=function(){var e,t,n=(e=this._environment,"PluralReaderSelector"===(t=this._selector).kind?t.selectors.map((function(t){return e.lookup(t)})):e.lookup(t));this._result=C(n),this.subscribe()},e.prototype.getData=function(){return this._result?this._result.data:null},e.prototype.subscribe=function(){var e=this,t=this._environment,n=this._result.snapshot;this._disposable&&this._disposable.dispose(),n||(this._disposable={dispose:function(){}});var r=[];Array.isArray(n)?n.forEach((function(n,o){r.push(t.subscribe(n,(function(t){e._result.snapshot[o]=t,e._result.data[o]=t.data,e.refreshHooks()})))})):r.push(t.subscribe(n,(function(t){e._result=C(t),e.refreshHooks()}))),this._disposable={dispose:function(){r.map((function(e){return e.dispose()}))}}},e.prototype.changeVariables=function(e,t){"PluralReaderSelector"===this._selector.kind?this._selector.selectors=this._selector.selectors.map((function(n){return b(t,n,e)})):this._selector=b(t,this._selector,e),this.lookup()},e.prototype.lookupInStore=function(e,t,n){if(f(n)){var r=e.check(t);if("available"===r||"available"===r.status)return this._retainCachedOperation(t),e.lookup(t.fragment)}return null},e.prototype._fetchPage=function(e,t,n,i){var a,s=this,u=null!=(a=this._selector)&&"PluralReaderSelector"===a.kind?a.selectors[0]?a.selectors[0].owner.variables:{}:a?a.owner.variables:{},l=c(c(c({},u),this.getFragmentVariables()),this._refetchVariables),f=e.getVariables(this.getData(),{count:t.count,cursor:t.cursor},l);return o("object"==typeof f&&null!==f,"ReactRelayPaginationContainer: Expected `getVariables()` to return an object, got `%s` in `%s`.",f,"useFragment pagination"),f=c(c({},f),this._refetchVariables),l=c(c({},f),l),this.executeFetcher(e.query,f,i,n,(function(n,o,i){var a=s.getData();s.changeVariables((e.getFragmentVariables||s.paginationData.getFragmentVariables)(l,t.totalCount),n.request.node);var u,c,f,p=s.getData();r(a,p)?i():(s.refreshHooks(),u=s,f=function(){return function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,(function(e){return i(),[2]}))},new((c=void 0)||(c=Promise))((function(e,t){function n(e){try{o(f.next(e))}catch(e){t(e)}}function r(e){try{o(f.throw(e))}catch(e){t(e)}}function o(t){t.done?e(t.value):new c((function(e){e(t.value)})).then(n,r)}o((f=f.apply(u,[])).next())})))}))},e.prototype.executeFetcher=function(e,n,r,o,i){var a=this,s=r?{force:!!r.force}:void 0;null!=s&&r&&null!=r.metadata&&(s.metadata=r.metadata);var u,f="function"==typeof o?{next:o,error:o}:o||{},h=p(e,n),d=(r||{}).fetchPolicy,b=void 0===d?"network-only":d,g=this.lookupInStore(this._environment,h,b);null!=g&&i(h,null,(function(){f.next&&f.next(),f.complete&&f.complete()})),this._refetchSubscription&&this._refetchSubscription.unsubscribe();var m=l(b,g);if(!m)return{dispose:function(){}};if(m){var y=this._environment.retain(h),v=null!=s?{networkCacheConfig:s}:{},_=function(){a._selectionReferences=a._selectionReferences.concat(y),a._refetchSubscription===u&&(a._refetchSubscription=null,a._isARequestInFlight=!1)};this._isARequestInFlight=!0,F(this._environment,h,v).mergeMap((function(e){return t.Observable.create((function(t){i(h,e,(function(){t.next(void 0),t.complete()}))}))})).do({error:_,complete:_,unsubscribe:_}).subscribe(c(c({},f),{start:function(e){u=e,a._refetchSubscription=a._isARequestInFlight?u:null,f.start&&f.start(e)}}))}return{dispose:function(){u&&u.unsubscribe()}}},e}();function k(e,t){var r=w(),o=n.useState(null)[1],i=n.useRef(null);null==i.current&&(i.current={resolver:new q(o)});var a=i.current.resolver;return n.useEffect((function(){return function(){a.dispose()}}),[a]),a.resolve(r,e,t),[a.getData(),a]}var O=s.useCallback,E=s.useState;function x(e,t){var n=k(e,t);return[n[0],n[1].refetch]}Object.defineProperty(e,"applyOptimisticMutation",{enumerable:!0,get:function(){return t.applyOptimisticMutation}}),Object.defineProperty(e,"commitLocalUpdate",{enumerable:!0,get:function(){return t.commitLocalUpdate}}),Object.defineProperty(e,"commitMutation",{enumerable:!0,get:function(){return t.commitMutation}}),Object.defineProperty(e,"fetchQuery",{enumerable:!0,get:function(){return t.fetchQuery}}),Object.defineProperty(e,"graphql",{enumerable:!0,get:function(){return t.graphql}}),Object.defineProperty(e,"requestSubscription",{enumerable:!0,get:function(){return t.requestSubscription}}),e.FORWARD="forward",e.NETWORK_ONLY="network-only",e.ReactRelayContext=u,e.RelayEnvironmentProvider=function(e){var t=s.useMemo((function(){return{environment:e.environment}}),[e.environment]);return s.createElement(u.Provider,{value:t},e.children)},e.STORE_ONLY="store-only",e.STORE_OR_NETWORK="store-or-network",e.STORE_THEN_NETWORK="store-and-network",e.loadLazyQuery=function(){return P(!0)},e.loadQuery=function(){return P(!1)},e.useFragment=function(e,t){return k(e,t)[0]},e.useLazyLoadQuery=function(e,t,n){void 0===t&&(t={}),void 0===n&&(n={});var r=w(),o=S(e,t);return R(o).execute(r,o,n)},e.useMutation=function(e,n,r){void 0===n&&(n={});var i=E({loading:!1,data:null,error:null}),s=i[0],u=i[1],l=a(),f=w(),p=r||f,h=n.configs,d=n.variables,b=n.uploadables,g=n.onCompleted,m=n.onError,y=n.optimisticUpdater,v=n.optimisticResponse,_=n.updater;return[O((function(n){var r=c({configs:h,variables:d,uploadables:b,onCompleted:g,onError:m,optimisticUpdater:y,optimisticResponse:v,updater:_},n);return o(r.variables,"you must specify variables"),u({loading:!0,data:null,error:null}),new Promise((function(n,o){function i(e){l()&&u({loading:!1,data:null,error:e}),r.onError?(r.onError(e),n()):o(e)}t.commitMutation(p,c(c({},r),{mutation:e,variables:r.variables,onCompleted:function(e,t){t?i(t):(l()&&u({loading:!1,data:e,error:null}),r.onCompleted&&r.onCompleted(e),n(e))},onError:i}))}))}),[p,h,e,d,b,g,m,y,v,_,l]),s]},e.useOssFragment=k,e.usePagination=function(e,t){var r=k(e,t),o=r[1];return[r[0],n.useMemo((function(){return{loadMore:o.loadMore,hasMore:o.hasMore,isLoading:o.isLoading,refetchConnection:o.refetchConnection}}),[o])]},e.usePreloadedQuery=function(e){var t=n.useState()[1],r=w();return n.useEffect((function(){var n=e.subscribe(t);return function(){return n()}}),[e]),e.getValue(r)},e.useQuery=function(e,t,n){void 0===t&&(t={}),void 0===n&&(n={});var r=w(),o=S(e,t);return R().execute(r,o,n)},e.useQueryFetcher=R,e.useRefetch=x,e.useRefetchable=function(e,r){var i=x(e,r),a=i[0],s=i[1],u=n.useMemo((function(){var n=t.getFragment(e),r=n.metadata;o(null!=r,"useRefetchable: Expected fragment `%s` to be refetchable when using `%s`. Did you forget to add a @refetchable directive to the fragment?","useRefetchable",n.name),o(!0!==r.plural,"useRefetchable: Expected fragment `%s` not to be plural when using `%s`. Remove `@relay(plural: true)` from fragment `%s` in order to use it with `%s`.",n.name,"useRefetchable",n.name,"useRefetchable");var i=r.refetch;return o(null!=i,"useRefetchable: Expected fragment `%s` to be refetchable when using `%s`. Did you forget to add a @refetchable directive to the fragment?","useRefetchable",n.name),i.operation.default?i.operation.default:i.operation}),[e]);return[a,n.useCallback((function(e,t){return void 0===t&&(t={}),s(u,e,t.renderVariables,t.observerOrCallback,t.refetchOptions)}),[s,u])]},e.useRelayEnvironment=w,e.useSubscription=function(e){var r=w();n.useEffect((function(){return t.requestSubscription(r,e).dispose}),[r,e])},Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=umd-relay-hooks.min.js.map
